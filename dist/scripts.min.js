let pokemonRepository = (function() {
  let e = [],
    t = 'https://pokeapi.co/api/v2/pokemon/?limit=10',
    n = document.querySelector('#modal-container');
  function i() {
    let e = document.querySelector('.pokemon-list'),
      t = document.createElement('div');
    t.setAttribute('class', 'pokemon-list__item'),
      (t.innerText = 'loading your Pokemon data...'),
      e.prepend(t);
  }
  function o() {
    let e = document.querySelector('div.pokemon-list__item');
    e.parentElement.removeChild(e);
  }
  function a(t) {
    'object' == typeof t && 'name' in t && 'detailsUrl' in t
      ? e.push(t)
      : alert('Invalid attempt to add non-object to pokemonList');
  }
  function l(e, t) {
    e.addEventListener('click', function() {
      !(function(e) {
        pokemonRepository.loadDetails(e).then(function() {
          !(function(e) {
            let t = $('.modal-body'),
              n = $('.modal-title');
            $('.modal-header');
            n.empty(), t.empty();
            let i = document.createElement('p');
            i.innerText = 'ID: ' + e.id;
            let o = document.createElement('img');
            o.setAttribute('src', e.imageUrl),
              o.classList.add('img-fluid'),
              o.classList.add('mb-2'),
              o.classList.add('pokepic');
            let a = document.createElement('p');
            a.innerText = 'Height : ' + e.height / 0.1 + ' cm';
            let l = document.createElement('p');
            l.innerText = 'Weight : ' + e.weight / 10 + ' kg';
            let r = document.createElement('p');
            r.innerText = 'Types : ' + e.types;
            let d = document.createElement('p');
            (d.innerText = 'Abilities : ' + e.abilities),
              n.append(e.name),
              t.append(i),
              t.append(o),
              t.append(a),
              t.append(l),
              t.append(r),
              t.append(d);
          })(e);
        });
      })(t);
    });
  }
  return (
    window.addEventListener('keydown', e => {
      'Escape' === e.key && n.classList.contains('is-visible') && hideModal();
    }),
    (function() {
      let e = document.querySelector('#register-form'),
        t = document.querySelector('#email'),
        n = document.querySelector('#password');
      function i() {
        let e = t.value;
        return e
          ? -1 === e.indexOf('@')
            ? (a(t, 'You must enter a valid email address.'), !1)
            : (a(t, null), !0)
          : (a(t, 'Email is a required field.'), !1);
      }
      function o() {
        let e = n.value;
        return e
          ? e.length < 8
            ? (a(n, 'The password needs to be at least 8 characters long.'), !1)
            : (a(n, null), !0)
          : (a(n, 'Password is a required field.'), !1);
      }
      function a(e, t) {
        let n = e.parentElement,
          i = n.querySelector('.error-message');
        if ((i && n.removeChild(i), t)) {
          let e = document.createElement('div');
          e.classList.add('error-message'), (e.innerText = t), n.appendChild(e);
        }
      }
      e.addEventListener('submit', e => {
        e.preventDefault(),
          (function() {
            let e = i(),
              t = o();
            return e && t;
          })() && alert('Success!');
      }),
        t.addEventListener('input', i),
        n.addEventListener('input', o);
    })(),
    {
      add: a,
      getAll: function() {
        return e;
      },
      addListItem: function(e) {
        let t = document.querySelector('.pokemon-list'),
          n = document.createElement('li'),
          i = document.createElement('button');
        (i.innerText = e.name),
          i.classList.add('button-class'),
          i.classList.add('list-group-item'),
          i.classList.add('text-capitalize'),
          i.setAttribute('type', 'button'),
          i.classList.add('btn'),
          i.classList.add('btn-outline-dark'),
          i.setAttribute('data-target', '#pokemon-info'),
          i.setAttribute('data-toggle', 'modal'),
          i.setAttribute('data-bs-name', e.name),
          n.appendChild(i),
          l(i, e),
          t.appendChild(n);
      },
      loadList: function() {
        return (
          i(),
          fetch(t)
            .then(function(e) {
              return e.json();
            })
            .then(function(e) {
              o(),
                e.results.forEach(function(e) {
                  let t = { name: e.name, detailsUrl: e.url };
                  a(t), console.log(t);
                });
            })
            .catch(function(e) {
              o(), console.error(e);
            })
        );
      },
      loadDetails: function(e) {
        i();
        let t = e.detailsUrl;
        return fetch(t)
          .then(function(e) {
            return e.json();
          })
          .then(function(t) {
            o(),
              (e.id = t.id),
              (e.imageUrl = t.sprites.other.dream_world.front_default),
              (e.height = t.height),
              (e.weight = t.weight),
              (e.types = []),
              t.types.forEach(function(t) {
                e.types.push(' ' + t.type.name + ' ');
              }),
              (e.abilities = []),
              t.abilities.forEach(function(t) {
                e.abilities.push(' ' + t.ability.name + ' ');
              });
          })
          .catch(function(e) {
            o(), console.error(e);
          });
      }
    }
  );
})();
pokemonRepository.loadList().then(function() {
  pokemonRepository.getAll().forEach(function(e) {
    pokemonRepository.addListItem(e);
  });
});
